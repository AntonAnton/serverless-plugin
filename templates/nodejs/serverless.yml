service: yandex-cloud-nodejs
frameworkVersion: ">2.0.0"

provider:
  name: yandex-cloud
  runtime: nodejs16

plugins:
  - "@yandex-cloud/serverless-plugin"

package:
  exclude:
    - ./**
  include:
    - ./dist/*.js
    - ./package.json
    - ./package-lock.json

functions:
  simple:
    handler: dist/index.hello
    memorySize: 128
    timeout: 5
    account: function-sa

  timer:
    handler: dist/index.hello
    memorySize: 128
    timeout: 5
    events:
      - cron:
          expression: "* * * * ? *"
          account: trigger-sa
          retry:
            attempts: 1
            interval: 10

resources:
  trigger-sa:
    type: yc::ServiceAccount
    roles:
      - serverless.functions.invoker
  function-sa:
    type: yc::ServiceAccount
    roles:
      - editor
